<!DOCTYPE html>
<html lang="en">
  
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Setting up my homelab and cloud with Nix &middot; Gunwant Jain - @wantguns</title>
    <meta name="description" content="Gunwant Jain&amp;#x27;s (@wantguns) writings and musings" />
    <link rel="apple-touch-icon" sizes="180x180" href="https://wantguns.dev/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="https://wantguns.dev/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="https://wantguns.dev/favicon-16x16.png" />
    <link rel="manifest" href="https://wantguns.dev/site.webmanifest" />
    <link rel="alternate" type="application/atom+xml" title="RSS" href="https://wantguns.dev/atom.xml">

    <style>:root{color-scheme:dark}html,body{background:#000;color:rgba(255,255,255,.9);padding:.3rem;margin:.3rem;text-rendering:optimizeLegibility;font-variant-ligatures:contextual;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-family:Charter,"Bitstream Charter","Sitka Text",Cambria,serif;font-weight:400;font-size:16.5px;line-height:1.6}h1,h2,h3,h4,h5,h6{color:#fbcb97;font-family:Charter,"Bitstream Charter","Sitka Text",Cambria,serif;font-weight:900}h1.page_title{letter-spacing:-1px;font-weight:900;font-size:200%;line-height:normal;color:#fbcb97;margin-bottom:1rem;line-height:1.1}a{text-decoration:underline;color:rgba(255,255,255,.9)}a:visited{color:rgba(255,255,255,.9);text-decoration:none}a:active{color:#fbcb97}a:hover{color:#fbcb97}a.site_title{text-decoration:none;margin-bottom:.2rem;color:#e78a53;font-weight:900;list-style:1}a.site_title:hover{text-decoration:underline}a.site_nav{text-decoration:none;color:#e78a53}a.site_nav:hover{text-decoration:underline}a.homepage-list_title{flex:1;word-wrap:break-word;text-decoration:none;font-weight:bold;font-family:Charter,"Bitstream Charter","Sitka Text",Cambria,serif;color:#fbcb97}a.homepage-list_title:hover{text-decoration:underline}a code{text-decoration-color:rgba(251,203,151,.9)}a.footer{color:#888}a.footer:hover{color:#fbcb97}.pipe{color:#202020}time.site_time{font-size:90%;color:#888}span.page_time{padding:1.2rem auto;color:#888}:target{background-color:#000}hr{border:none;height:1px;background-color:#202020}::selection{background:#333}main{margin:auto;max-width:650px}header{padding-top:1rem;padding-bottom:0rem;font-weight:900}code{font-family:ui-monospace,"SFMono-Regular","SF Mono","Cascadia Code","Source Code Pro",Menlo,Consolas,"DejaVu Sans Mono",monospace;letter-spacing:normal;background-color:rgba(251,203,151,.175);padding-left:.25rem;padding-right:.25rem;font-size:14.5px;color:rgba(251,203,151,.9)}code a{text-decoration-color:rgba(251,203,151,.9)}pre{position:relative;font-family:ui-monospace,"SFMono-Regular","SF Mono","Cascadia Code","Source Code Pro",Menlo,Consolas,"DejaVu Sans Mono",monospace;font-weight:400;letter-spacing:normal;line-height:1.5;overflow:auto;border:thin solid #202020;margin:2rem 0rem;padding:1.5rem;background-color:#000}pre code{font-size:14px;padding:initial;color:inherit;background-color:inherit}.pre-wrapper{position:relative;margin:2rem 0}.copy-button{position:absolute;top:0px;right:0px;color:#fbcb97;background-color:#000;border:thin solid #202020;width:60px;height:28px;padding:5px 10px;font-size:12px;font-family:Charter,"Bitstream Charter","Sitka Text",Cambria,serif;font-weight:400;cursor:pointer;opacity:.8;transition:all .2s ease}.copy-button:hover{opacity:1}.copy-button.copied{border:thin solid #fbcb97}table{border-collapse:collapse;width:100%}th,td{border:1px solid #202020;padding:1.1rem}img{height:auto;margin:2rem 0rem;max-width:100%}.homepage-list,.taxonomies__list{list-style:none;padding:1rem 0}.homepage-list li,.taxonomies__list li{align-items:center;display:flex;flex-wrap:nowrap;justify-content:space-between;margin-bottom:10px}.center{margin-left:auto;margin-right:auto;max-width:100%;text-align:center}.imageClass,.videoClass{padding:.5rem}.imageClass figure,.videoClass figure{display:table}.imageClass figure img,.videoClass figure img{user-select:none}.imageClass figure figcaption,.videoClass figure figcaption{display:table-caption;caption-side:bottom;padding:.2rem;margin:.2rem auto;background-color:#fbcb97;color:#000}.imageClass figure figcaption::selection,.videoClass figure figcaption::selection{background-color:#e78a53}@media (max-width: 38rem){.homepage-list li a{width:100%}}footer{margin-top:2rem;color:#888}.pagination_title{width:100%;text-align:center;border-bottom:1px solid #202020;line-height:.1em;margin:2.5rem auto}.pagination_title span{background:#000;font-size:.8rem;padding:0 10px}.post_nav{display:flex;align-items:center;justify-content:center;text-align:center;margin:2.5rem auto 4rem auto}.post_nav .button{position:relative;display:inline-flex;flex:1;align-items:center;justify-content:center;overflow:hidden;text-decoration:none;margin:auto 1.5rem;font-weight:bold}.post_nav .button .previous,.post_nav .button .next{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.time_tag_sep{padding:.5rem;color:#888;user-select:none}.post_tags a{padding:0 .5rem 0 0;color:#888;text-decoration:none}.post_tags a:hover{color:#fbcb97}.taxonomies__title{color:#888}.taxonomies__list a{text-decoration:none}#toc-inline,#toc-aside{font-size:90%;line-height:1.6;color:#888}#toc-inline a,#toc-aside a{color:#888;text-decoration:none}#toc-inline a:hover,#toc-aside a:hover{color:#fbcb97}#toc-inline ul,#toc-aside ul{padding-left:1rem}#toc-inline li li,#toc-aside li li{list-style:disc}#toc-inline li.active>a,#toc-aside li.active>a{color:#fbcb97;font-weight:bold}#toc-inline{font-family:Charter,"Bitstream Charter","Sitka Text",Cambria,serif;padding:1.25rem 0rem .5rem 0rem}#toc-inline summary:hover{cursor:pointer;color:#fbcb97}#toc-aside{font-family:Charter,"Bitstream Charter","Sitka Text",Cambria,serif;display:block;width:15rem;position:sticky;float:left;top:3.5rem;margin-top:-1.2rem;margin-left:-20rem}@media (max-width: 80rem){#toc-aside{display:none}}@media (min-width: 80rem){#toc-inline{display:none}}sup{line-height:0}.footnote-reference{color:#fbcb97}.footnote-reference:after{content:"]"}.footnote-reference:before{content:"["}.footnote-reference a{color:#fbcb97;text-decoration:none}hr{margin-top:2rem;margin-bottom:2rem}.footnote-definition{display:flex;flex-direction:row;font-size:.85rem}.footnote-definition sup{all:initial;color:rgba(255,255,255,.9);text-rendering:optimizeLegibility;font-variant-ligatures:contextual;font-family:Charter,"Bitstream Charter","Sitka Text",Cambria,serif;font-weight:450;font-size:1rem;line-height:1.58;letter-spacing:-.02em;font-size:.7rem;margin:0rem;margin-right:.5rem}.footnote-definition p{margin:0rem;margin-bottom:1rem}.footnote-definition p .footnote-backlink{margin:0rem;margin-left:.5rem;color:#fbcb97;text-decoration:none}</style>

    <meta property="og:site_name" content="Gunwant Jain - @wantguns">
      <meta name="author" content="Gunwant Jain" />
      <meta name="keywords" content="Gunwant Jain, wantguns, Gunwant, WantGuns" />
      <meta property="og:title" content="Setting up my homelab and cloud with Nix">
      <meta property="og:description" content="">
      <meta property="og:url" content="https://wantguns.dev/yakshaving/">
      <meta property="og:image" content="">

      <meta name="twitter:card" content="summary">
      <meta name="twitter:title" content="Gunwant Jain - @wantguns">
      <meta name="twitter:description" content="Gunwant Jain&#x27;s (@wantguns) writings and musings">

      <meta property="og:type" content="article" />
        <meta property="article:published_time" content="2025-03-04T00:00:00+00:00" />

      
      
    

  </head>
  

  <body>
    <main id="main" role="main">
      
      <header role="banner">
          
            
            <nav style="margin-bottom:1rem;" role="navigation">
              
                <a class="site_nav" href="https://wantguns.dev/about">about</a>
                
                  <span>&nbsp</span>
                
              
                <a class="site_nav" href="https://wantguns.dev">blog</a>
                
                  <span>&nbsp</span>
                
              
                <a class="site_nav" href="https://wantguns.dev/tags">tags</a>
                
                  <span>&nbsp</span>
                
              
                <a class="site_nav" href="https://bin.wantguns.dev/cv">resume</a>
                
                  <span>&nbsp</span>
                
              
                <a class="site_nav" href="https://wantguns.dev/atom.xml">rss</a>
                
              
            </nav>
            
          
      </header>
      


    <div>

      
<article>
  <h1 class="page_title">Setting up my homelab and cloud with Nix</h1>

  
    <span class="page_time">Posted on <time datetime="2025-03-04T00:00:00+00:00">March 04, 2025</time></span>
    
    <span class="time_tag_sep">&middot;</span>
    <span class="post_tags">
        
            <a href="https://wantguns.dev/tags/yakshaving/">#yakshaving</a>
        
            <a href="https://wantguns.dev/tags/selfhosting/">#selfhosting</a>
        
            <a href="https://wantguns.dev/tags/nix/">#nix</a>
        
    </span>
    
  

  
  
    
    <details id = "toc-inline">
        <summary><b>Table of Contents</b></summary>
        <ul>
            <li>
                <a href="#tradeoffs">Tradeoffs</a>
                
            </li><li>
                <a href="#concepts">Concepts</a>
                
            </li><li>
                <a href="#dev-logs">Dev logs</a>
                
            </li>
        </ul>
    </details>

    
  <aside id="toc-aside">
          <h4>Table of Contents</h4>
      <ul>
          
          <li>
              <a href="#tradeoffs">Tradeoffs</a>
              
          </li>
          <li>
              <a href="#concepts">Concepts</a>
              
          </li>
          <li>
              <a href="#dev-logs">Dev logs</a>
              
          </li>
      </ul>
  </aside>

  
  

  <p>I have been maintaining a set of cloud servers, for the purpose of
selfhosting a ton of software, VPNs, and random experimentation.
Recently, I bought a Dell Optiplex 3040 for Rs. 5000 ($60), and I am
planning to revamp all my scattered scripts and make orchestration easy
for a one person team.</p>
<h3 id="tradeoffs">Tradeoffs</h3>
<p>I have a pragramtic approach to selfhosting. Until now, I have only used
traefik 2.0, docker-compose, caddy. I do have lots of services running
and I wanted an orchestration solution which is flexible. Web apps are
mostly running on cloud native technology nowadays, and so Kubernetes
stood out easily.</p>
<p>As a selfhoster, I can foresee changes in infrastructure less often, and
so I don't exactly want to treat my servers as cattle. I want to be able
to audit everything and easily onboard new hosts though. Ansible is a
good option, but it feels like a leaky abstraction for IaC. I am going
to go yolo on nix and see how far it can take me.</p>
<h3 id="concepts">Concepts</h3>
<p>I have had multiple scattered thoughts on what designs fits best for my
needs, and I have realised:</p>
<ul>
<li>a terminal session is my forte, I want to be able to replicate my
dotfiles on new hosts.</li>
<li>I am fine with running NixOS as my userland. I can also run nix-darwin
on Macbooks.</li>
<li>I am going to hand over all the hardware and os-level configuration to
Nix, and will use a deployment tool like deploy-rs.</li>
<li>I want all of my nodes to form a mesh, preferrably using wireguard,
and preferrably not using proprietary tools like Tailscale, need to
make a tradeoff for that.</li>
<li>I want to orchestrate selfhosted services over different nodes, with
affinities and selectors and resource constraints. I'll use
Kubernetes, or K3s, more accurately to acheive this.</li>
<li>I also like Gitops, mostly for the auditing and single source of truth
features. Planning to use FluxCD and Github for gitops.</li>
</ul>
<p>With a setup like this, I will be able to setup new servers and handle
any sort of load pretty quickly. The good thing with nix is that we can
also have tiers based on how much control I want to give to new
hardware, I might just want my normal terminal session on a contract
work's server.</p>
<h3 id="dev-logs">Dev logs</h3>
<p>I am going to start blogging about my journey, here is timeline i'll
keep updating:</p>
<ul>
<li><input disabled="" type="checkbox" checked=""/>
<a href="/homemanager">Home Manager</a></li>
<li><input disabled="" type="checkbox" checked=""/>
<a href="/nixdarwin">Nix Darwin</a></li>
<li><input disabled="" type="checkbox" checked=""/>
<a href="/nixmultihost">Single Flake Multiple Hosts</a>
<ul>
<li>files available on <a href="https://github.com/wantguns/dotfiles">github</a></li>
</ul>
</li>
<li><input disabled="" type="checkbox" checked=""/>
<a href="/nixos-anywhere">Setting up Mintaka and Bellatrix</a></li>
<li><input disabled="" type="checkbox"/>
Setting up a Wireguard network</li>
</ul>

</article>


  <div class="pagination_title">
    <span>Read other posts</span>
  </div>
  <div class="post_nav">
      
        <div class="button">
          <a class="button" href="&#x2F;lmdb-jni-jetson-nano&#x2F;">
            ←&nbsp;
            <span class="next">
              Building LMDB JNI for Jetson Nano
            </span>
          </a>
        </div>
      
      
        <div class="button">
          <a class="button" href="&#x2F;homemanager&#x2F;">
            <span class="previous">Home Manager</span>
            &nbsp;→
          </a>
        </div>
      
    </div>



    </div>
    </main>

    
    

    <footer class=center>
      <sub>
        <div>
            &copy;
            <span id="copyright">
                <script>document.getElementById('copyright').appendChild(document.createTextNode(new Date().getFullYear()))</script>
            </span>
            &middot;
            Gunwant Jain. Built <a class="footer" href="https://github.com/wantguns/wantguns.dev">openly</a> with <a class="footer" href="https://www.getzola.org">Zola</a>
        </div>
      </sub>
    </footer>
  </body>
  
 <script src=https://wantguns.dev/js/page.js></script> 

</html>
